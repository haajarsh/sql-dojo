/* Calculate total revenue, revenue for the 'Condiments' and 'Confections' categories for each year and quarter.*/

SELECT
  DATE_TRUNC('quarter', order_date) AS revenue_quarter,
  SUM(oi.amount) AS total_revenue,
  SUM(CASE WHEN c.category_name = 'Condiments' THEN oi.amount ELSE 0.0 END) AS condiments_revenue,
  SUM(CASE WHEN c.category_name = 'Confections' THEN oi.amount ELSE 0.0 END) AS confections_revenue
FROM order_items AS oi
JOIN orders AS o
  	ON oi.order_id = o.order_id
JOIN products AS p
	ON oi.product_id = p.product_id
JOIN categories AS c
	ON p.category_id = c.category_id
GROUP BY DATE_TRUNC('quarter', order_date)
ORDER BY DATE_TRUNC('quarter', order_date);


| revenue_quarter        | total_revenue | condiments_revenue | confections_revenue |
| ---------------------- | ------------- | ------------------ | ------------------- |
| 2016-07-01 00:00:00+00 | 79728.58      | 5988.40            | 17118.93            |
| 2016-10-01 00:00:00+00 | 128355.41     | 11911.99           | 12566.63            |
| 2017-01-01 00:00:00+00 | 138288.95     | 13026.08           | 19316.93            |
| 2017-04-01 00:00:00+00 | 143177.07     | 12852.70           | 21403.33            |
| 2017-07-01 00:00:00+00 | 153937.83     | 13315.05           | 20276.83            |
| 2017-10-01 00:00:00+00 | 181681.50     | 16174.80           | 21660.69            |
| 2018-01-01 00:00:00+00 | 193637.42     | 11031.87           | 20908.63            |
| 2021-04-01 00:00:00+00 | 6004.69       | 1756.00            | 1144.80             |
| 2021-07-01 00:00:00+00 | 7941.80       | 195.00             | 2574.40             |
| 2021-10-01 00:00:00+00 | 5728.73       | 1355.00            | 1092.33             |
| 2022-01-01 00:00:00+00 | 11689.96      | 782.58             | 2419.25             |
| 2022-04-01 00:00:00+00 | 14145.01      | 790.00             | 7367.06             |
| 2022-07-01 00:00:00+00 | 8396.10       | 427.00             | 253.00              |
| 2022-10-01 00:00:00+00 | 8440.22       | 0.0                | 1413.26             |
| 2023-01-01 00:00:00+00 | 28033.25      | 4272.70            | 2098.15             |
| 2023-04-01 00:00:00+00 | 28720.82      | 2793.85            | 5164.93             |
| 2023-07-01 00:00:00+00 | 10789.87      | 1261.35            | 187.38              |
| 2023-10-01 00:00:00+00 | 22378.13      | 1684.00            | 462.00              |
| 2024-01-01 00:00:00+00 | 13183.45      | 442.05             | 3919.25             |
| 2024-04-01 00:00:00+00 | 35514.28      | 2425.70            | 911.48              |
| 2024-07-01 00:00:00+00 | 11141.13      | 2203.13            | 2516.60             |
| 2024-10-01 00:00:00+00 | 11324.10      | 228.00             | 210.00              |
| 2025-01-01 00:00:00+00 | 12783.85      | 553.40             | 1156.25             |
| 2025-04-01 00:00:00+00 | 10771.14      | 576.50             | 1215.18             |