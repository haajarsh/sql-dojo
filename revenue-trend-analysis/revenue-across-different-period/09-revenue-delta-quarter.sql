/* Calculate total revenue for each quarter in each year alongside the delta (revenue change) as compared to the previous quarter.*/

SELECT
  	DATE_TRUNC('quarter', order_date) AS revenue_quarter,
  	SUM(amount) AS total_revenue,
  	SUM(amount) - LAG(SUM(amount), 1) OVER(ORDER BY DATE_TRUNC('quarter', order_date)) AS delta
FROM orders
GROUP BY DATE_TRUNC('quarter', order_date)
ORDER BY DATE_TRUNC('quarter', order_date);


| revenue_quarter        | total_revenue | delta      |
| ---------------------- | ------------- | ---------- |
| 2016-07-01 00:00:00+00 | 79728.58      | null       |
| 2016-10-01 00:00:00+00 | 128355.41     | 48626.83   |
| 2017-01-01 00:00:00+00 | 138288.95     | 9933.54    |
| 2017-04-01 00:00:00+00 | 143177.07     | 4888.12    |
| 2017-07-01 00:00:00+00 | 153937.83     | 10760.76   |
| 2017-10-01 00:00:00+00 | 181681.50     | 27743.67   |
| 2018-01-01 00:00:00+00 | 193637.42     | 11955.92   |
| 2021-04-01 00:00:00+00 | 6004.69       | -187632.73 |
| 2021-07-01 00:00:00+00 | 7941.80       | 1937.11    |
| 2021-10-01 00:00:00+00 | 5728.73       | -2213.07   |
| 2022-01-01 00:00:00+00 | 11689.96      | 5961.23    |
| 2022-04-01 00:00:00+00 | 14145.01      | 2455.05    |
| 2022-07-01 00:00:00+00 | 8396.10       | -5748.91   |
| 2022-10-01 00:00:00+00 | 8440.22       | 44.12      |
| 2023-01-01 00:00:00+00 | 28033.25      | 19593.03   |
| 2023-04-01 00:00:00+00 | 28720.82      | 687.57     |
| 2023-07-01 00:00:00+00 | 10789.87      | -17930.95  |
| 2023-10-01 00:00:00+00 | 22378.13      | 11588.26   |
| 2024-01-01 00:00:00+00 | 13183.45      | -9194.68   |
| 2024-04-01 00:00:00+00 | 35514.28      | 22330.83   |
| 2024-07-01 00:00:00+00 | 11141.13      | -24373.15  |
| 2024-10-01 00:00:00+00 | 11324.10      | 182.97     |
| 2025-01-01 00:00:00+00 | 12783.85      | 1459.75    |
| 2025-04-01 00:00:00+00 | 10771.14      | -2012.71   |